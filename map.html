<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>Map</title>
  <style>
    html,
    body {
      height: 100vh;
      padding: 0;
      margin: 0;
    }

    @media screen and (max-width: 768px) {
      #map {
        height: 50vh;
        width: 100vw;
        overflow: hidden;
        float: left;
        border: thin solid #333;
      }

      #capture {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-content: flex-start;
        align-items: flex-start;
        background-color: #ECECFB;
        border: thin solid #333;
        overflow: hidden;
        overflow-y:scroll;
        min-height: 50%;
        max-height:50%;
      }

      .image-container {
        position: relative;
        width: calc(33.33% - 10px);
        height: 16.66vh;
        margin-top: 10px;
        margin-bottom: 10px;
        margin-right: 5px;
        margin-left: 5px;
        overflow: hidden;
      }

      .image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      #add-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50%;
        height: auto;
        max-width: 100%;
      }
    }

    @media screen and (min-width: 769px) {
      #map {
        height: 100vh;
        width: 50vw;
        overflow: hidden;
        float: left;
        border: thin solid #333;
      }

      #capture {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-content: flex-start;
    align-items: flex-start;
    background: linear-gradient(-45deg, rgba(24, 115, 147, 0.8), rgba(35, 77, 213, 0.8), rgba(35, 166, 213, 0.8), rgba(35, 213, 171, 0.8));
    background-size: 200% 200%;
    animation: gradient 15s ease infinite;
    border: thin solid #333;
    overflow-y: scroll;
    min-height: 100%;
    max-height: 100%;
}


      .image-container {
        position: relative;
        width: calc(33.33% - 10px);
        height: 16.66vh;
        margin-top: 10px;
        margin-bottom: 10px;
        margin-right: 5px;
        margin-left: 5px;
        overflow: hidden;
      }

      .image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      #add-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50%;
        height: auto;
        max-width: 100%;
      }
    }

    .map-marker-label {
      position: absolute;
      color: white;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="capture">
    <div class="image-container">
      <img id="add-icon" src="img/add.png" />
    </div>

    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>
    <div class="image-container" style="display: none;">
      <img src="img/placeholder.png">
    </div>



  </div>
  <script>
   var map;
      var src = 'https://raw.githubusercontent.com/jiaowh/jiaowh.github.io/42689ec24a8e24216a4aefeaf0f9ae293b3a30f2/test.kml';

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: new google.maps.LatLng(35.68339538574219, 139.765380859375),
          zoom: 7,
        });

        var kmlLayer = new google.maps.KmlLayer({
          url: src,
          suppressInfoWindows: true,
          preserveViewport: false,
          map: map
        });

      var pinClicked = false; // Variable to track if a pin is clicked

      kmlLayer.addListener('click', function (event) {
        var placemarkName = event.featureData.name;

        var point = event.latLng;
        var markerSize = {
          x: 22,
          y: 40
        };

        var marker = new google.maps.Marker({
          position: point,
          map: map,
          label: placemarkName,
          draggable: false,
          icon: {
            path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
            scale: 0,
            fillColor: 'blue', // Set the marker color to blue
            fillOpacity: 0,
            strokeWeight: 0
          }
        });

        // Set pinClicked to true when a pin is clicked
        pinClicked = true;

        google.maps.Marker.prototype.setLabel = function (label) {
          this.label = new MarkerLabel({
            map: this.map,
            marker: this,
            text: label
          });
          this.label.bindTo('position', this, 'position');
        };

        var MarkerLabel = function (options) {
          this.setValues(options);
          this.span = document.createElement('span');
          this.span.className = 'map-marker-label';
        };

        MarkerLabel.prototype = Object.create(google.maps.OverlayView.prototype);
        MarkerLabel.prototype.onAdd = function () {
          this.getPanes().overlayImage.appendChild(this.span);
          var self = this;
          this.listeners = [
            google.maps.event.addListener(this, 'position_changed', function () {
              self.draw();
            })
          ];
        };
        MarkerLabel.prototype.draw = function () {
          var text = String(this.get('text'));
          var position = this.getProjection().fromLatLngToDivPixel(this.get('position'));
          this.span.innerHTML = text;
          this.span.style.left = (position.x - (markerSize.x / 2)) - (text.length * 3) + 10 + 'px';
          this.span.style.top = (position.y - markerSize.y + 40) + 'px';
        };

        var description = event.featureData.description;
        var imageContainers = document.querySelectorAll('.image-container');

        // Show all image containers if a pin is clicked
        if (pinClicked) {
          for (var i = 1; i < imageContainers.length; i++) {
            imageContainers[i].style.display = 'block';
          }
        }

        // Extract image URLs from the description
        var parser = new DOMParser();
        var xmlDoc = parser.parseFromString(description, 'text/xml');
        var imageUrls = xmlDoc.querySelectorAll('img');

        // Hide or show image containers based on the number of images extracted
        for (var i = 1; i < imageContainers.length; i++) {
          if (i - 1 < imageUrls.length) {
            var image = imageContainers[i].querySelector('img');
            image.src = imageUrls[i - 1].getAttribute('src'); // Set image source
            imageContainers[i].style.display = 'block'; // Show image container
          } else {
            imageContainers[i].style.display = 'none'; // Hide extra image containers
          }
        }
      });
    }
  </script>
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZClCw9r5G_GaA_EWmWVNrKcOzPZOvux0&callback=initMap&libraries=visualization&v=weekly"></script>
  <script>
    // Function to expand image to 100% width when clicked
    function expandImage(event) {
      var image = event.target;
      if (image.id === 'add-icon') {
        return; // Exit the function without performing any action
      }

      if (window.innerWidth < window.innerHeight) {
      var image = event.target; // Get the clicked image
      image.style.width = '100vw'; // Set width to 100vw (viewport width)
      image.style.height = 'auto'; // Set height to auto for aspect ratio preservation
      image.style.position = 'fixed'; // Set position to absolute to prevent image from shifting when zooming in/out
      image.style.left = 0;
      image.style.top = '50%';
      image.style.transform = 'translateY(-50%)'; // Move the image upward by 50% of its own height
      image.style.zIndex = '9999';}
      else {
        var image = event.target; // Get the clicked image
      image.style.width = 'auto'; // Set width to 100vw (viewport width)
      image.style.height = '100vh'; // Set height to auto for aspect ratio preservation
      image.style.position = 'fixed'; // Set position to absolute to prevent image from shifting when zooming in/out
      image.style.top = 0;
      image.style.left = '50%';
      image.style.transform = 'translateX(-50%)'; // Move the image upward by 50% of its own height
      
      image.style.zIndex = '9999';}

      var blackoutScreen = document.createElement('div');
      blackoutScreen.style.position = 'fixed';
      blackoutScreen.style.top = '0';
      blackoutScreen.style.left = '0';
      blackoutScreen.style.width = '100%';
      blackoutScreen.style.height = '100%';
      blackoutScreen.style.backgroundColor = 'rgba(255, 255, 255, 0.4)'; // Semi-transparent white color
      blackoutScreen.style.boxShadow = '0 4px 30px rgba(0, 0, 0, 0.1)'; // Box shadow
      blackoutScreen.style.backdropFilter = 'blur(5.6px)'; // Backdrop filter for blur effect
      blackoutScreen.style.webkitBackdropFilter = 'blur(5.6px)';
      blackoutScreen.style.zIndex = '9998'; // Set a lower z-index than the image to ensure the image is above the blackout screen
      document.body.appendChild(blackoutScreen);

      // Remove the event listener to prevent further expansion on subsequent clicks
      image.removeEventListener('click', expandImage);

      // Add event listener to body to return image to original state when anywhere on the screen is clicked
      document.body.addEventListener('click', function () {
        image.style.width = ''; // Reset width to default (auto)
        image.style.height = ''; // Reset height to default (auto)
        image.style.zIndex = '';
        image.style.position = 'absolute';

        document.body.removeChild(blackoutScreen);

        // Reattach the event listener for image container click to enable expansion on subsequent clicks
        image.addEventListener('click', expandImage);

        // Remove the click event on the body to prevent resetting the image size on subsequent clicks
        document.body.removeEventListener('click', arguments.callee);
      });

      // Prevent event propagation to prevent body click event from firing immediately
      event.stopPropagation();
    }

    // Attach click event listener to each image container
    var imageContainers = document.querySelectorAll('.image-container img');
    imageContainers.forEach(function (image) {
      image.addEventListener('click', expandImage);
    });
  </script>

</body>

</html>